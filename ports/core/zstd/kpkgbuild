# description   : Zstandard is a real-time compression algorithm, providing high compression ratios.
# depends       : zlib xz lz4

name=zstd
version=1.5.7
release=1
source="https://github.com/facebook/zstd/releases/download/v$version/$name-$version.tar.gz"

build() {
        cd $name-$version

        # Patch makefile to prevent color output from ls/grep
        # Replace the fragile ls | grep pipeline with find
        # Patch makefile to prevent color output from ls/grep
        # Replace the fragile ls | grep pipeline with find
        # Match matches $(shell ls $(LIB_SRCDIR)/legacy/*.c | $(GREP) ...)
        sed -i 's/$(shell ls .*|.*(GREP).*)/$(shell find $(LIB_SRCDIR)\/legacy -name "*.c" | grep "v0\[$(ZSTD_LEGACY_SUPPORT)-7\]")/g' lib/libzstd.mk

        # Extra safety
        export TERM=dumb
        unalias ls 2>/dev/null || true
        unalias grep 2>/dev/null || true

        make

        make
        make PREFIX=/usr DESTDIR=$PKG install
}
